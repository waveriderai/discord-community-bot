# Discord 社群經營機器人 - 產品需求文件 (PRD)

## 1. 產品概述

### 1.1 產品名稱
WaveRider Discord Community Bot

### 1.2 產品定位
一個智慧化的 Discord 社群管理機器人，整合 Claude AI 提供智慧問答，並串接 WaveRider 資料庫自動推播交易訊號，為交易討論社群和產品用戶社群提供 24/7 自動化服務。

### 1.3 目標用戶
- **交易社群成員**：股票/動能交易愛好者，需要即時訊號和策略討論
- **WaveRider 產品用戶**：使用 WaveRider 平台的用戶，需要產品支援和功能回饋管道
- **社群管理員**：需要高效管理工具來維護社群品質

---

## 2. 問題陳述

### 2.1 現有痛點
1. **人工回覆效率低**：常見問題重複詢問，管理員疲於應付
2. **訊號推播不即時**：交易訊號需要手動發布，容易遺漏或延遲
3. **新成員流失**：缺乏導引機制，新成員不知如何參與
4. **社群管理分散**：無法透過統一介面管理 Discord

### 2.2 解決方案
建立一套整合方案：
- **MCP Server**：讓 Claude CLI 直接操作 Discord
- **Discord Bot**：24/7 自動化回覆與推播
- **N8N 整合**：串接現有資料管線自動推播訊號

---

## 3. 功能需求

### 3.1 核心功能 (P0 - Must Have)

#### 3.1.1 智慧問答系統
| 功能 | 說明 | 驗收條件 |
|------|------|----------|
| FAQ 自動回覆 | 使用 Claude API 回答常見問題 | 回覆延遲 < 3 秒 |
| 上下文理解 | 理解對話脈絡，提供連貫回答 | 支援多輪對話 |
| 知識庫整合 | 載入產品文件、交易策略作為知識來源 | 可更新知識庫 |

#### 3.1.2 交易訊號推播
| 功能 | 說明 | 驗收條件 |
|------|------|----------|
| 自動推播 | 從資料庫讀取訊號並發送到指定頻道 | 訊號產生後 1 分鐘內推播 |
| 訊號格式化 | 美觀的 Embed 訊息格式 | 包含股票代號、價格、訊號類型 |
| 頻道路由 | 不同類型訊號發送到不同頻道 | 可配置路由規則 |

**串接資料表：**
- `pam_swing_ideas` - 波段交易點子
- `pam_daytrade_ideas` - 當沖交易點子
- `ak_trade_ideas` - AK 交易訊號
- `eg_watchlist` - 觀察清單

#### 3.1.3 新成員導引
| 功能 | 說明 | 驗收條件 |
|------|------|----------|
| 歡迎訊息 | 新成員加入時自動發送歡迎訊息 | 加入後 5 秒內觸發 |
| 規則說明 | 自動發送社群規則 | 可自訂規則內容 |
| 角色分配 | 根據回應自動分配角色 | 支援 Reaction Role |

### 3.2 重要功能 (P1 - Should Have)

#### 3.2.1 MCP Server 整合
| 功能 | 說明 | 驗收條件 |
|------|------|----------|
| 頻道管理 | 透過 Claude CLI 建立/刪除頻道 | 指令執行成功 |
| 訊息發布 | 透過 Claude CLI 發送公告 | 支援 Embed 格式 |
| 訊息查詢 | 讀取特定頻道的訊息歷史 | 支援分頁查詢 |

#### 3.2.2 內容審核
| 功能 | 說明 | 驗收條件 |
|------|------|----------|
| 關鍵字過濾 | 過濾垃圾訊息和違規內容 | 可自訂黑名單 |
| 投資建議免責 | 偵測投資建議並自動加上免責聲明 | 準確率 > 90% |

#### 3.2.3 數據統計
| 功能 | 說明 | 驗收條件 |
|------|------|----------|
| 活躍度統計 | 追蹤成員發言數、活躍時段 | 每日報表 |
| 訊號績效 | 追蹤推播訊號的後續表現 | 週報 |

### 3.3 未來功能 (P2 - Nice to Have)

- 語音頻道通知
- 定期舉辦 AMA (Ask Me Anything)
- 交易競賽排行榜
- 多語系支援

---

## 4. 技術架構

### 4.1 系統架構圖

```
┌─────────────────────────────────────────────────────────────┐
│                      Discord Server                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │ 交易訊號 │ │ 策略討論 │ │ 產品支援 │ │ 新手區   │        │
│  └────▲─────┘ └────▲─────┘ └────▲─────┘ └────▲─────┘        │
└───────┼────────────┼────────────┼────────────┼──────────────┘
        │            │            │            │
        └────────────┴─────┬──────┴────────────┘
                           │
┌──────────────────────────┼──────────────────────────────────┐
│                    Discord Bot (Python)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │ 訊息處理器  │  │ 訊號推播器  │  │ 成員管理器  │          │
│  └──────┬──────┘  └──────┬──────┘  └─────────────┘          │
│         │                │                                   │
│  ┌──────▼──────┐  ┌──────▼──────┐                           │
│  │ Claude API  │  │ DB Connector │                           │
│  └─────────────┘  └─────────────┘                           │
└─────────────────────────────────────────────────────────────┘
        │                  │
        ▼                  ▼
┌───────────────┐  ┌───────────────────────────────────────────┐
│  Claude API   │  │           MariaDB (173.255.248.164)       │
│  (Anthropic)  │  │  • pam_swing_ideas    • eg_watchlist      │
└───────────────┘  │  • pam_daytrade_ideas • market_monitor    │
                   └───────────────────────────────────────────┘
                           │
                           ▼
                   ┌───────────────┐
                   │  N8N 工作流程  │
                   │ (173.255.253.61)│
                   └───────────────┘
```

### 4.2 技術選型

| 元件 | 技術 | 說明 |
|------|------|------|
| Bot 框架 | discord.py | Python Discord API 封裝 |
| AI 引擎 | Claude API (Anthropic) | 智慧問答 |
| 資料庫 | MariaDB | 串接現有 WaveRider 資料庫 |
| 工作流程 | N8N | 定時任務、Webhook 觸發 |
| MCP Server | Python FastAPI | Discord API 封裝為 MCP |
| 部署 | Docker | 容器化部署到現有伺服器 |

### 4.3 資料流

```
1. 智慧問答流程:
   用戶訊息 → Bot 接收 → Claude API 處理 → Bot 回覆

2. 訊號推播流程:
   N8N 定時觸發 → 查詢 DB → 格式化訊號 → Discord Webhook/Bot API

3. MCP 操作流程:
   Claude CLI → MCP Server → Discord API → Discord Server
```

---

## 5. 頻道結構建議

```
📊 交易區
├── 📢 每日選股 (Bot 推播)
├── 📈 波段訊號 (Bot 推播)
├── ⚡ 當沖訊號 (Bot 推播)
├── 💬 策略討論 (開放討論)
└── 📚 學習資源 (只讀)

🏠 社群區
├── 📢 公告 (只讀)
├── 👋 自我介紹
├── 💬 閒聊
└── 🎉 成就分享

🔧 產品區
├── ❓ 問題回報
├── 💡 功能建議
├── 📖 使用教學 (只讀)
└── 🤖 Bot 問答 (Claude 回覆)

🔒 管理區 (僅管理員)
├── 📊 數據報表
└── ⚙️ Bot 設定
```

---

## 6. API 與整合

### 6.1 需要的 API Keys

| API | 用途 | 取得方式 |
|-----|------|----------|
| Discord Bot Token | Bot 認證 | ✅ 已有 |
| Claude API Key | 智慧問答 | Anthropic Console |
| MariaDB 連線 | 資料存取 | 現有設定 |

### 6.2 N8N Webhook 整合

現有 N8N 工作流程可透過 Webhook 觸發 Bot 推播：
- `*BZ Moving Stocks` → 觸發異動股推播
- `*Market Sentiment Analysis` → 觸發市場情緒分析

---

## 7. 開發階段

### Phase 1: 基礎架構 (MVP)
- [ ] Discord Bot 專案設定
- [ ] 基本指令框架 (ping, help)
- [ ] Claude API 整合
- [ ] 簡單問答功能

### Phase 2: 訊號推播
- [ ] MariaDB 連線
- [ ] 訊號格式化 (Embed)
- [ ] 定時推播機制
- [ ] N8N Webhook 整合

### Phase 3: 社群管理
- [ ] 新成員歡迎
- [ ] 角色自動分配
- [ ] 內容審核

### Phase 4: MCP Server
- [ ] FastAPI MCP Server
- [ ] Claude CLI 整合設定
- [ ] 頻道/訊息管理 API

---

## 8. 成功指標 (KPIs)

| 指標 | 目標 | 衡量方式 |
|------|------|----------|
| 問答回覆率 | > 95% 問題獲得回覆 | Bot 日誌統計 |
| 回覆滿意度 | > 80% 正向反應 | Reaction 統計 |
| 訊號推播及時率 | > 99% 在 1 分鐘內 | 時間戳比對 |
| 新成員留存 | > 60% 7日留存 | Discord Insights |
| 社群活躍度 | DAU > 100 | Discord Insights |

---

## 9. 風險與緩解

| 風險 | 影響 | 緩解措施 |
|------|------|----------|
| Claude API 費用過高 | 成本失控 | 設定用量上限、快取常見回答 |
| Bot 回答不準確 | 用戶體驗差 | 人工審核機制、信心度閾值 |
| Discord API 限流 | 推播延遲 | 批次處理、佇列機制 |
| 投資建議法規 | 法律風險 | 強制免責聲明、禁止明確買賣建議 |

---

## 10. 附錄

### 10.1 相關文件
- [WaveRider 資料圖書館](../docs/waverider-data-library.md)
- [N8N 工作流程文件](../WaveRider.ai/docs/n8n-workflows/)

### 10.2 參考資源
- [discord.py 官方文件](https://discordpy.readthedocs.io/)
- [Claude API 文件](https://docs.anthropic.com/)
- [Discord Developer Portal](https://discord.com/developers/)

---

## 變更記錄

| 版本 | 日期 | 作者 | 變更說明 |
|------|------|------|----------|
| 1.0 | 2026-01-27 | Product Team | 初版建立 |
